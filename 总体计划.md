# 开发计划

基于需求文档，将开发分为以下阶段：


## 阶段一：项目基础搭建

### 1.1 项目结构初始化
- 创建单一 Maven 项目，按 package 划分模块：
  - `com.webcli.agent`：本地 Agent 相关
  - `com.webcli.server`：远端 WebServer 相关
  - `com.webcli.common`：公共模块（协议定义、工具类）
- 前端静态资源放置在 `src/main/resources` 目录下

### 1.2 依赖引入
- JfireBoot 框架
- pty4j 库
- xterm.js（前端）


## 阶段二：核心功能开发

### 2.1 PTY 管理模块（Agent）
- PTY 创建与销毁
- PTY 输入/输出流管理
- 多 PTY 实例管理
- PTY 与本地终端的双向绑定

### 2.2 TCP 通信协议
- 定义消息协议格式（Magic + Length + Type + Payload）
- 消息类型定义：
  - `REGISTER`：Agent 注册
  - `HEARTBEAT`：心跳
  - `PTY_OUTPUT`：终端输出
  - `PTY_INPUT`：终端输入
  - `PTY_RESIZE`：终端大小调整
  - `PTY_LIST`：PTY 列表
  - `PERMISSION_UPDATE`：权限变更
- 基于 JfireBoot 实现 TCP 客户端（Agent）和服务端（WebServer）

### 2.3 本地 Web 服务（Agent）
- 基于 JfireBoot 启动 HTTP 服务，绑定 127.0.0.1
- WebSocket 端点实现
- PTY 管理 API（创建、关闭、列表）
- 权限管理 API（授权/取消远端输入）

### 2.4 远端 WebServer
- TCP 服务端：接收 Agent 连接
- Agent 会话管理
- Web 服务：提供终端查看界面
- WebSocket 端点：转发终端输入输出


## 阶段三：前端开发

### 3.1 终端界面
- xterm.js 集成
- WebSocket 连接管理
- 终端输入输出处理
- 终端 resize 事件处理

### 3.2 管理界面（本地 Web）
- PTY 列表展示与切换
- PTY 创建/关闭操作
- 远端输入权限管理


## 阶段四：权限与安全

### 4.1 权限控制实现
- Agent 侧权限状态管理
- 远端输入过滤逻辑
- 权限变更通知机制

### 4.2 安全加固
- 本地 Web 服务仅绑定 127.0.0.1
- Agent 与 WebServer 通信认证（可选：Token 验证）


## 阶段五：集成测试与优化

### 5.1 功能测试
- 本地终端 + 本地 Web + 远端 Web 三端同步测试
- 权限控制测试
- 多 PTY 并发测试

### 5.2 性能优化
- 输出流缓冲与批量发送
- 大量输出时的流控处理


## 开发优先级

1. **P0（核心路径）**：PTY 管理 → TCP 通信 → 本地 Web 服务 → 基础前端
2. **P1（完整功能）**：远端 WebServer → 权限控制 → 管理界面
3. **P2（增强）**：安全加固 → 性能优化
